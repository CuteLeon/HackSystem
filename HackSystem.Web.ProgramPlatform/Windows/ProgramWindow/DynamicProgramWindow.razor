@inject ILogger<DynamicProgramWindow> Logger
@inject IIntermediaryCommandSender CommandSender

<ResizeableView Top=@this.ProgramWindowStyle.Top
                Left=@this.ProgramWindowStyle.Left
                Width=@this.ProgramWindowStyle.Width
                Height=@this.ProgramWindowStyle.Height>
    <div class="modal-dialog m-0 flex-fill modal-dialog-scrollable" role="dialog" style="max-width:none;max-height:none;height:100%;">
        <div class="modal-content @this.ProgramWindowStyle.Border.ToBorderStyle() @this.ProgramWindowStyle.BorderColor.ToBorderColor() @this.ProgramWindowStyle.BackgroundColor.ToBackgroundColor() overflow-hidden" style="height: 100%; @(this.ProgramWindowStyle.BackgroundColor==Colors.Transparent?"backdrop-filter:blur(20px);":string.Empty)">
            <DraggableHandleComponent DragTarget=".position-fixed">
                <div class="modal-header bg-light py-2">
                    <h5 class="modal-title" id="exampleModalLabel">@this.ProgramWindowDetail.Caption</h5>
                    <button type="button" class="close" onclick=@this.OnClose>
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            </DraggableHandleComponent>
            <div class="modal-body">
                <DynamicComponent @ref=this.DynamicProgramComponent
                                  Type="this.ProgramWindowDetail.ProgramWindowType"
                                  Parameters="new Dictionary<string, object>
                                  {
                                      { nameof(ProgramComponentBase.ProcessDetail), this.ProcessDetail },
                                      { nameof(ProgramComponentBase.ProgramWindowDetail), this.ProgramWindowDetail }
                                  }">
                </DynamicComponent>
            </div>
        </div>
    </div>
</ResizeableView>

@code {
    // TODO: LEON: JS to set style="z-index:@this.ProgramWindowDetail.TierIndex"

    [Parameter]
    public ProcessDetail ProcessDetail { get; set; }

    [Parameter]
    public ProgramWindowDetail ProgramWindowDetail { get; set; }

    public DynamicComponent DynamicProgramComponent { get; set; }

    public ProgramWindowStyle ProgramWindowStyle { get; set; } = new();

    public virtual void OnClose()
    {
        this.Logger.LogInformation($"Close entry window {this.ProgramWindowDetail.WindowId} of process {this.ProcessDetail.ProcessId}...");
        this.CommandSender.Send(new WindowDestroyCommand(this.ProgramWindowDetail));
    }
}
