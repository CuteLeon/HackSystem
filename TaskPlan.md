# 桌面设计

## 菜单和状态栏

​	桌面顶部显示菜单和状态栏，用与实现系统状态和程序菜单

### 菜单栏

​	显示当前程序的菜单，默认显示桌面菜单

### 状态栏

​	显示当前系统状态

## 图标容器

​	桌面主体部分为图标容器，用于显示用户的程序（图标和名称）

- [ ] 图标右键菜单
  - [ ] 打开
  - [ ] 隐藏/取消隐藏
  - [ ] 固定/取消固定 到程序坞
  - [ ] 重命名
  - [ ] *固定到页顶部*
  - [ ] 删除

## 程序坞

​	悬浮在桌面下方，用于固定显示常用的程序和已经运行的程序

- [ ] 已运行的程序，仅暂放而不固定在程序坞
   - [ ] 同一程序的多个实例合并显示
- [ ] 图标右键菜单
   - [ ] 打开
   - [ ] 固定/取消固定 到程序坞

## 信息面板

​	桌面主体浮动显示信息面板，用于显示数据信息

- [ ] 时间
- [ ] 天气
- [ ] 任务列表

# 进程管理器

​	启动新程序进程，维护运行中的程序进程和组件，关闭程序进程。

​	每个程序进程对应一个组件实例。

## 程序组件基类

​	程序组件基类继承自ComponentBase类，并由程序组件继承

- [ ] 参数：程序进程模型实例
- [ ] 关闭程序组件时请求调用进程管理器的结束进程方法

## 程序进程模型

- [ ] PID (自动生成GUID)
- [ ] 程序ID
- [ ] 组件类型程序集路径
- [ ] Z-Index
- [ ] 显示状态枚举
   - [ ] 正常
   - [ ] 最大化
   - [ ] 最小化
   - [ ] Quick View (速览)
- [ ] 置顶显示

## 进程管理器

- [ ] 使用字典 (\<PID, 程序组件实例>(主字典) 和 \<程序ID,\<PID, 程序组件实例>>(从字典) 需要保持从主至从的单向同步) 和双向链表维护所有进程 (LRU算法)
- [ ] 点击程序图标调用创建组件的方法，根据程序的组件的程序集路径动态反射创建组件的实例，创建对应的程序进程模型，并通过反射写入程序进程模型到程序组件实例
- [ ] 将最近使用的进程提升至链表头部，未使用的进程自动沉降到链表尾部
   - [ ] 启动新程序自动插入链表头部
   - [ ] 使用链表顺序作为进程组件的显示顺序的依据
   - [ ] 显示顺序还应区分组件是否为置顶显示
   - [ ] 链表顺序更新后，按程序的显示顺序重新渲染 (考虑渲染性能代价最小的方案)
     - [ ] 绑定组件的 z-index 到属性
- [ ] 结束进程方法：在字典和链表中删除此程序组件，视为关闭了一个进程
- [ ] 正在运行的程序集合变化时，通知程序坞更新显示状态

## 程序层

- [ ] 按进程管理内维护的数据渲染程序组件实例

   - [ ] 使用 RenderFragment 和 RenderTreeBuilder 渲染程序的实例
- [ ] 需要注意 RenderTreeBuilder 与差分算法对性能最佳的写法
   

# 应用商店

​	用于显示已发售的应用程序

1. 显示所有可用的程序
2. 供用户启用自己喜欢的程序

# API

## 程序API

​	~~仅允许Hacker角色访问~~

1. ~~获取当前用户的所有程序及映射~~
   1. ~~返回当前授权用户的NameClaim返回其程序，及用户对程序的映射信息~~
   2. ~~程序图标返回一个指向程序资源API的URL~~
2. ~~设置用户对程序的隐藏字段~~
3. ~~设置用户对程序的固定到坞字段~~
4. ~~设置用户对程序的固定到顶部字段~~
5. ~~设置用户对程序的重命名字段~~
6. ~~删除用户对程序的映射~~

## 程序资源API

1. 获取程序的图标文件及其它资源
2. 实现一个Resource服务用于封装文件IO实现上传(Admin)和下载程序资源

## 应用商店API

​	仅允许Hacker和Commander角色访问

1. 获取所有可用的程序
2. 上架应用程序
3. 禁用/启用应用程序
4. 下架应用程序

## 数据模型

### Program

1. ~~记录程序基本信息~~

### UserProgramMap

1. ~~记录用户对程序的映射信息~~
   1. ~~隐藏~~
   2. ~~固定到坞~~
   3. ~~固定到顶部~~
   4. ~~重命名~~



# Z-Index

## 桌面

### 图标容器

```scss
$zindex-iconcontainer:    0-49 !default;
```

### 信息面板

```scss
$zindex-infopanel:    50-149 !default;
```

### 程序坞

```scss
$zindex-programdock:    150-199 !default;
```

## 程序

### 普通程序

```scss
$zindex-normalprogram:    200-849 !default;
```

### 置顶程序

```scss
$zindex-topprogram:    850-999 !default;
```

## Bootstrap 保留

```scss
$zindex-dropdown:          1000 !default;
$zindex-sticky:            1020 !default;
$zindex-fixed:             1030 !default;
$zindex-modal-backdrop:    1040 !default;
$zindex-modal:             1050 !default;
$zindex-popover:           1060 !default;
$zindex-tooltip:           1070 !default;
```

